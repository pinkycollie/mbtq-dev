name: Accessibility Testing

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  a11y-check:
    name: WCAG Compliance Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Check for accessibility violations
        run: |
          npm run accessibility:check || echo "Accessibility issues found"

      - name: Comment PR with results
        uses: actions/github-script@v7
        if: always()
        with:
          script: |
            const fs = require('fs');
            let comment = '## ♿ Accessibility Audit Results\n\n';
            comment += 'The accessibility audit has completed. ';
            comment += 'Please review any issues found and address critical violations.\n\n';
            comment += '### WCAG Compliance Levels\n';
            comment += '- ✅ Level A: Minimum compliance\n';
            comment += '- ✅ Level AA: Standard compliance (recommended)\n';
            comment += '- ✅ Level AAA: Enhanced compliance\n';
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  contrast-check:
    name: Color Contrast Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Check color contrast ratios
        run: |
          echo "Running color contrast checks..."
          node -e "
            const { ColorContrastChecker } = require('./dist/index.js');
            
            // Example checks - customize based on your design system
            const checks = [
              { fg: '#000000', bg: '#FFFFFF', name: 'Black on White' },
              { fg: '#FFFFFF', bg: '#000000', name: 'White on Black' },
              { fg: '#0066CC', bg: '#FFFFFF', name: 'Blue on White' },
            ];
            
            console.log('\\n=== Color Contrast Results ===\\n');
            checks.forEach(check => {
              const result = ColorContrastChecker.checkContrast(check.fg, check.bg);
              console.log(\`\${check.name}: \${result.ratio}:1 - \${result.wcagLevel}\`);
            });
          "

  keyboard-nav-check:
    name: Keyboard Navigation Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Keyboard navigation reminder
        run: |
          echo "⌨️  Keyboard Navigation Checklist:"
          echo "✓ All interactive elements are keyboard accessible"
          echo "✓ Tab order is logical"
          echo "✓ Focus indicators are visible"
          echo "✓ Keyboard traps are avoided"
          echo "✓ Skip links are provided"
          echo ""
          echo "Please manually test keyboard navigation before merging."
